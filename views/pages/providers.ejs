<% layout("/layouts/boilerplate.ejs") %>

<div class="container py-5">
  <h1 class="text-center mb-5 text-primary">
    <%= category.name %> - Service Providers
  </h1>

  <% if (providers && providers.length > 0) { %>
  <div class="row row-cols-lg-3 row-cols-md-2 row-cols-1 g-4">
    <% providers.forEach(provider => { let matchedService = null;
    provider.servicesOffered.forEach(offer => { offer.services.forEach(s => { if
    (s.service == serviceId) matchedService = s; }); }); %>

    <div class="col">
      <div class="card shadow border-0 h-100 rounded-3 overflow-hidden">
        <!-- Profile Image -->
        <div class="card-img-wrapper">
          <img
            src="<%= provider.user.profileImage || 'https://cdn-icons-png.flaticon.com/512/4202/4202841.png' %>"
            class="card-img-top"
            alt="<%= provider.user.name %>"
          />
        </div>

        <!-- Provider Info -->
        <div class="card-body text-center">
          <h5 class="card-title mb-2 fw-bold text-dark">
            <%= provider.user.name %>
          </h5>

          <p class="card-text mb-1">
            <strong>Experience:</strong>
            <%= matchedService && matchedService.experience ?
            matchedService.experience : "N/A" %>
          </p>

          <p class="card-text mb-1">
            <strong>Price:</strong> â‚¹ <%= matchedService &&
            matchedService.customCost ? matchedService.customCost : "N/A" %>
          </p>

          <p class="card-text mb-0">
            <strong>Location:</strong>
            <%= provider.address || "Not Available" %>
          </p>
        </div>

        <!-- Action Button -->
        <div class="card-footer bg-transparent border-0 text-center">
          <form
            action="/services/<%= serviceId %>/<%= provider._id %>/book"
            method="get"
          >
            <button class="btn btn-primary w-100">
              <i class="fas fa-calendar-check me-2"></i>Book this Provider
            </button>
          </form>
        </div>
      </div>
    </div>
    <% }); %>
  </div>

  <% } else { %>
  <!-- No Providers -->
  <div class="text-center py-5">
    <div class="card shadow-sm border-0">
      <div class="card-body py-5">
        <i class="fas fa-user-slash fa-4x text-muted mb-3"></i>
        <h3 class="text-muted mb-3">No Providers Available</h3>
        <p class="text-muted mb-4">
          Sorry, there are currently no providers for this service.
        </p>
        <a href="/services" class="btn btn-outline-primary">
          <i class="fas fa-arrow-left me-2"></i>Back to Services
        </a>
      </div>
    </div>
  </div>
  <% } %>
</div>

<style>
  /* Adjust image to fit the card */
  .card-img-wrapper {
    height: 220px; /* Set a consistent height for all images */
    overflow: hidden;
    border-bottom: 2px solid #f0f0f0;
  }

  .card-img-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Ensures the image fills the space while maintaining aspect ratio */
    transition: transform 0.3s ease;
  }

  .card-img-wrapper img:hover {
    transform: scale(1.05); /* Slight zoom effect on hover */
  }

  /* Card styling */
  .card {
    border-radius: 15px;
    transition: all 0.3s ease;
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  }

  .card-footer {
    background-color: #f8f9fa;
  }

  .btn-primary {
    background-color: #007bff;
    border-color: #007bff;
    transition: all 0.3s ease;
  }

  .btn-primary:hover {
    background-color: #0056b3;
    border-color: #0056b3;
  }

  h1 {
    font-size: 2rem;
    font-weight: bold;
  }

  .card-title {
    font-size: 1.25rem;
  }

  .card-text {
    font-size: 0.95rem;
    color: #6c757d;
  }
</style>
