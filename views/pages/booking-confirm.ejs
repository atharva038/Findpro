<% layout("/layouts/boilerplate.ejs") %>
  <link rel="stylesheet" href="/css/booking.css" />

  <div class="booking-page">
    <div class="container py-4">
      <div class="card shadow-lg border-0 booking-card">
        <!-- Header -->
        <div class="card-header bg-primary text-white py-4">
          <h2 class="text-center mb-0">
            <i class="fas fa-clipboard-check me-2"></i>Confirm Your Booking
          </h2>
        </div>

        <!-- Body -->
        <div class="card-body p-4">
          <!-- Service Overview -->
          <div class="service-overview mb-4">
            <div class="row align-items-center">
              <div class="col-md-2 text-center mb-3 mb-md-0">
                <img src="<%= service.img %>" alt="<%= service.name %>" class="service-img" />
              </div>
              <div class="col-md-7 mb-3 mb-md-0">
                <h3 class="service-name">
                  <%= service.name %>
                </h3>
                <p class="provider-name mb-2">
                  <i class="fas fa-user me-2"></i>
                  <%= provider.user.name %>
                </p>
                <div class="service-details">
                  <span class="price">₹<%= serviceDetails.customCost %></span>
                  <span class="duration">
                    <i class="far fa-clock me-1"></i>
                    <%= service.duration %> mins
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- Booking Details -->
          <div class="booking-details mb-4">
            <h4 class="mb-3">Booking Details</h4>
            <div class="row g-3">
              <div class="col-md-6">
                <div class="detail-item">
                  <label class="text-muted">Date & Time</label>
                  <p class="mb-0">
                    <%= new Date(bookingData.date).toLocaleString() %>
                  </p>
                </div>
              </div>
              <div class="col-12">
                <div class="detail-item">
                  <label class="text-muted">Service Location</label>
                  <p class="mb-0">
                    <%= bookingData.detailedAddress %>
                  </p>
                </div>
              </div>
              <% if (bookingData.notes) { %>
                <div class="col-12">
                  <div class="detail-item">
                    <label class="text-muted">Special Instructions</label>
                    <p class="mb-0">
                      <%= bookingData.notes %>
                    </p>
                  </div>
                </div>
                <% } %>
            </div>
          </div>

          <!-- Payment Details -->
          <div class="payment-details mb-4">
            <h4 class="mb-3">Payment Details</h4>
            <div class="card bg-light">
              <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                  <span>Service Cost</span>
                  <span>₹<%= serviceDetails.customCost %></span>
                </div>
                <hr />
                <div class="d-flex justify-content-between mb-2">
                  <span>Advance Payment (10%)</span>
                  <span>₹<%= Math.round(serviceDetails.customCost * 0.1) %></span>
                </div>
                <div class="d-flex justify-content-between text-muted">
                  <span>Remaining Payment</span>
                  <span>₹<%= Math.round(serviceDetails.customCost * 0.9) %></span>
                </div>
                <hr />
                <div class="d-flex justify-content-between fw-bold">
                  <span>Total Amount</span>
                  <span>₹<%= serviceDetails.customCost %></span>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="d-grid gap-2">
            <button type="button" id="rzp-button" class="btn btn-primary btn-lg w-100" disabled>
              <span class="spinner-border spinner-border-sm me-2 d-none" role="status"></span>
              <i class="fas fa-credit-card me-2"></i>Proceed to Payment
            </button>
            <a href="javascript:history.back()" class="btn btn-outline-secondary">
              <i class="fas fa-arrow-left me-2"></i>Go Back
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <input type="hidden" id="booking-data" value='<%= JSON.stringify({
        date: bookingData.date,
        detailedAddress: bookingData.detailedAddress,
        notes: bookingData.notes || ""
    }) %>' />

  <input type="hidden" id="user-data" value='<%= JSON.stringify({
        name: user.name,
        email: user.username,
        phone: user.phone || "",
        razorpayKeyId: process.env.RAZORPAY_KEY_ID
    }) %>' />

  <input type="hidden" id="service-data" value="<%= JSON.stringify({
        serviceId: service._id,
        providerId: provider._id,
        customCost: serviceDetails.customCost
    }) %>" />

  <!-- Add these script tags at the bottom of the file -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="/js/payment.js"></script>