<section id="profile" class="dashboard-section">
  <div class="section-header">
    <h2><i class="fas fa-user-circle me-2"></i>Profile Information</h2>
    <button class="btn btn-primary btn-sm" onclick="openEditModal()">
      <i class="fas fa-edit me-1"></i>Edit Profile
    </button>
  </div>

  <div class="content-card">
    <div class="row">
      <!-- Profile Image Section -->
      <div class="col-md-4 text-center">
        <div class="profile-image-container mb-4">
          <img
            src="<%= user.profileImage || '/img/default-avatar.png' %>"
            alt="Profile"
            class="profile-image"
            id="profilePreview"
          />
          <div
            class="image-overlay"
            onclick="document.getElementById('profileImage').click()"
          >
            <i class="fas fa-camera"></i>
            <span>Change Photo</span>
          </div>
          <input
            type="file"
            id="profileImage"
            name="profileImage"
            accept="image/*"
            style="display: none"
          />
        </div>

        <h3 class="user-name mb-2"><%= user.name %></h3>
        <p class="user-email mb-4"><%= user.username %></p>
      </div>

      <!-- Profile Details Section -->
      <div class="col-md-8">
        <div class="profile-details">
          <div class="detail-item">
            <label><i class="fas fa-phone me-2"></i>Phone Number</label>
            <p><%= user.phone || 'Not provided' %></p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-map-marker-alt me-2"></i>Address</label>
            <p><%= user.addresses || 'Not provided' %></p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-envelope me-2"></i>Email</label>
            <p><%= user.username %></p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-calendar me-2"></i>Member Since</label>
            <p>
              <%= new Date(user.createdAt).toLocaleDateString('en-IN', { year:
              'numeric', month: 'long', day: 'numeric' }) %>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div class="modal fade" id="editProfileModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Profile</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>
        <div class="modal-body">
          <form id="editProfileForm">
            <div class="mb-3">
              <label class="form-label">Full Name</label>
              <input
                type="text"
                class="form-control"
                id="editName"
                value="<%= user.name %>"
                required
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Phone Number</label>
              <input
                type="tel"
                class="form-control"
                id="editPhone"
                value="<%= user.phone || '' %>"
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Address</label>
              <textarea class="form-control" id="editAddress" rows="3">
<%= user.address || '' %></textarea
              >
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="button" class="btn btn-primary" onclick="saveProfile()">
            Save Changes
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Image Crop Modal -->
  <div class="modal fade" id="imageCropModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Crop Profile Picture</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>
        <div class="modal-body">
          <div class="img-container">
            <img
              id="cropImage"
              src=""
              alt="Picture to crop"
              class="max-width-100"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="button" class="btn btn-primary" id="cropButton">
            <i class="fas fa-crop me-1"></i>Crop & Save
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .profile-image-container {
    position: relative;
    width: 150px;
    height: 150px;
    margin: 0 auto;
    border-radius: 50%;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .profile-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .image-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    opacity: 0;
    transition: opacity 0.3s;
    cursor: pointer;
  }

  .image-overlay:hover {
    opacity: 1;
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
  }

  .profile-details {
    background: #fff;
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  }

  .detail-item {
    margin-bottom: 1.5rem;
  }

  .detail-item:last-child {
    margin-bottom: 0;
  }

  .detail-item label {
    font-weight: 600;
    color: #4a5568;
    margin-bottom: 0.5rem;
    display: block;
  }

  .detail-item p {
    color: #2d3748;
    margin: 0;
  }

  .img-container {
    max-height: 400px;
    width: 100%;
    position: relative;
    background: #f7fafc;
    border-radius: 4px;
    overflow: hidden;
  }

  .img-container img {
    max-width: 100%;
    max-height: 400px;
  }

  .modal-lg {
    max-width: 800px;
  }

  .cropper-container {
    width: 100% !important;
    height: 400px !important;
  }
</style>
<script src="/js/profileEdit.js"></script>
